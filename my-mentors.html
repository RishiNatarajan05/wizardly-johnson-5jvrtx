<div class="profile-content">
  <div>
    <div class="profile-section">
      <h3 class="profile-section-title">Background</h3>
      <p>Originally from Russia, I transitioned from engineering to product management and can guide others on this path in the American business context.</p>
    </div>
    
    <div class="profile-section">
      <h3 class="profile-section-title">Areas of Expertise</h3>
      <div class="expertise-tags">
        <div class="expertise-tag">Product Strategy</div>
        <div class="expertise-tag">User Research</div>
        <div class="expertise-tag">Career Growth</div>
        <div class="expertise-tag">Roadmapping</div>
        <div class="expertise-tag">Team Leadership</div>
      </div>
    </div>
  </div>
  
  <div>
    <div class="match-info">
      <h3 class="profile-section-title">Match Details</h3>
      
      <div class="match-item">
        <div class="match-label">
          <span>Field Match</span>
          <span class="match-value">85%</span>
        </div>
        <div class="match-bar">
          <div class="match-fill" style="width: 85%"></div>
        </div>
      </div>
      
      <div class="match-item">
        <div class="match-label">
          <span>Skills Match</span>
          <span class="match-value">92%</span>
        </div>
        <div class="match-bar">
          <div class="match-fill" style="width: 92%"></div>
        </div>
      </div>
      
      <div class="match-item">
        <div class="match-label">
          <span>Overall Match</span>
          <span class="match-value">87%</span>
        </div>
        <div class="match-bar">
          <div class="match-fill" style="width: 87%"></div>
        </div>
      </div>
      
      <div class="profile-stats">
        <div class="profile-stat-item">
          <span class="profile-stat-label">Location</span>
          <span class="profile-stat-value">New York, NY</span>
        </div>
        <div class="profile-stat-item">
          <span class="profile-stat-label">Availability</span>
          <span class="profile-stat-value">Weekly</span>
        </div>
        <div class="profile-stat-item">
          <span class="profile-stat-label">Experience</span>
          <span class="profile-stat-value">6+ years</span>
        </div>
      </div>
      
      <button class="btn btn-primary" style="width: 100%; margin-top: 20px;" onclick="closeProfileAndOpenChat('elena')">
        Send Message
      </button>
    </div>
  </div>
</div>
</div>
</div>
</div>

<!-- Chat interface for Maya -->
<div class="chat-container" id="maya-chat">
<div class="chat-header">
<button class="back-button" onclick="closeChat('maya')">&larr;</button>
<div class="chat-avatar">M</div>
<div class="chat-info">
<div class="chat-name">Maya Chen</div>
<div class="chat-status">Software Engineer at Google</div>
</div>
</div>

<div class="chat-messages" id="maya-messages">
<div class="message message-received">
<div class="message-text">Hello! I'm Maya, your mentor through MentorMatch. I'm excited to start working with you on your career goals! Tell me a bit about yourself and what you're hoping to achieve through this mentorship.</div>
<div class="message-time">Yesterday, 3:45 PM</div>
</div>
</div>

<div class="chat-input">
<input type="text" id="maya-input" placeholder="Type your message...">
<button onclick="sendMessage('maya')">Send</button>
</div>
</div>

<!-- Chat interface for Raj -->
<div class="chat-container" id="raj-chat">
<div class="chat-header">
<button class="back-button" onclick="closeChat('raj')">&larr;</button>
<div class="chat-avatar">R</div>
<div class="chat-info">
<div class="chat-name">Raj Patel</div>
<div class="chat-status">Data Scientist at Microsoft</div>
</div>
</div>

<div class="chat-messages" id="raj-messages">
<div class="message message-received">
<div class="message-text">Hello! I'm excited to be your mentor in data science and machine learning. How can I help you develop your skills or advance your career in these areas?</div>
<div class="message-time">Yesterday, 10:15 AM</div>
</div>
</div>

<div class="chat-input">
<input type="text" id="raj-input" placeholder="Type your message...">
<button onclick="sendMessage('raj')">Send</button>
</div>
</div>

<!-- Chat interface for Elena -->
<div class="chat-container" id="elena-chat">
<div class="chat-header">
<button class="back-button" onclick="closeChat('elena')">&larr;</button>
<div class="chat-avatar">E</div>
<div class="chat-info">
<div class="chat-name">Elena Petrova</div>
<div class="chat-status">Product Manager at Amazon</div>
</div>
</div>

<div class="chat-messages" id="elena-messages">
<div class="message message-received">
<div class="message-text">Hi there! I'm Elena, and I'm looking forward to mentoring you. I'd love to hear about your background and career aspirations, especially if you're interested in product management.</div>
<div class="message-time">Monday, 2:30 PM</div>
</div>
</div>

<div class="chat-input">
<input type="text" id="elena-input" placeholder="Type your message...">
<button onclick="sendMessage('elena')">Send</button>
</div>
</div>

<!-- Footer -->
<footer>
<div class="footer-container">
<div class="footer-section">
<h3>About MentorMatch</h3>
<p>
  MentorMatch is dedicated to connecting mentors and mentees,
  empowering immigrants to achieve professional excellence through
  guidance and community support.
</p>
</div>
<div class="footer-section">
<h3>Quick Links</h3>
<ul>
  <li><a href="index.html">Home</a></li>
  <li><a href="index.html#features">Our Values</a></li>
  <li><a href="index.html#how-it-works">How It Works</a></li>
  <li><a href="index.html#immigrants">For Immigrants</a></li>
  <li><a href="resources.html">Resources</a></li>
  <li><a href="role-select.html">Join Us</a></li>
</ul>
</div>
<div class="footer-section">
<h3>Get Started</h3>
<ul>
  <li><a href="mentee.html">Become a Mentee</a></li>
  <li><a href="mentor.html">Become a Mentor</a></li>
</ul>
</div>
<div class="footer-section">
<h3>Contact Us</h3>
<ul>
  <li>Email: info@mentormatch.com</li>
  <li>Phone: +1 (123) 456-7890</li>
  <li>Location: Austin, TX, USA</li>
</ul>
</div>
</div>
<p style="text-align: center; margin-top: 20px">
&copy; 2025 MentorMatch. All Rights Reserved.
</p>
</footer>

<!-- Load external script for functionality -->
<!-- Replace the current inline script with our updated module script -->
<script type="module">
// Import the Perplexity integration
import { generatePerplexityResponse } from './perplexity-chat.js';

// Handle profile modals
function openProfile(mentor) {
document.getElementById(`${mentor}-profile-modal`).style.display = 'flex';
}

function closeProfile(mentor) {
document.getElementById(`${mentor}-profile-modal`).style.display = 'none';
}

// Handle chat views
function openChat(mentor) {
document.getElementById('mentors-list-view').style.display = 'none';
document.getElementById(`${mentor}-chat`).style.display = 'flex';
}

function closeChat(mentor) {
document.getElementById(`${mentor}-chat`).style.display = 'none';
document.getElementById('mentors-list-view').style.display = 'block';
}

function closeProfileAndOpenChat(mentor) {
closeProfile(mentor);
openChat(mentor);
}

// Utility function to escape HTML to prevent XSS
function escapeHtml(unsafe) {
return unsafe
.replace(/&/g, "&amp;")
.replace(/</g, "&lt;")
.replace(/>/g, "&gt;")
.replace(/"/g, "&quot;")
.replace(/'/g, "&#039;");
}

// Handle sending messages
async function sendMessage(mentor) {
const inputElement = document.getElementById(`${mentor}-input`);
const messagesContainer = document.getElementById(`${mentor}-messages`);
const message = inputElement.value.trim();

if (message === '') return;

// Get current time
const now = new Date();
const timeString = now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });

// Add user message
messagesContainer.innerHTML += `
<div class="message message-sent">
  <div class="message-text">${escapeHtml(message)}</div>
  <div class="message-time">${timeString}</div>
</div>
`;

// Clear input
inputElement.value = '';

// Show typing indicator
messagesContainer.innerHTML += `
<div class="typing-indicator" id="${mentor}-typing">
  <div class="typing-dot"></div>
  <div class="typing-dot"></div>
  <div class="typing-dot"></div>
</div>
`;

// Scroll to bottom
messagesContainer.scrollTop = messagesContainer.scrollHeight;

try {
// Get user from session storage, default to mentee role
const userJson = sessionStorage.getItem("demoUser");
const user = userJson ? JSON.parse(userJson) : { role: "mentee" };

// Call the Perplexity API via our wrapper function
const response = await generatePerplexityResponse(message, mentor, user.role);

// Remove typing indicator
document.getElementById(`${mentor}-typing`).remove();

// Add response message
messagesContainer.innerHTML += `
  <div class="message message-received">
    <div class="message-text">${escapeHtml(response)}</div>
    <div class="message-time">${timeString}</div>
  </div>
`;

// Scroll to bottom again
messagesContainer.scrollTop = messagesContainer.scrollHeight;
} catch (error) {
console.error("Error generating response:", error);

// Remove typing indicator
document.getElementById(`${mentor}-typing`).remove();

// Show error message
messagesContainer.innerHTML += `
  <div class="message message-received">
    <div class="message-text">I'm sorry, I encountered an error while processing your message. Please try again later.</div>
    <div class="message-time">${timeString}</div>
  </div>
`;

// Scroll to bottom
messagesContainer.scrollTop = messagesContainer.scrollHeight;
}
}

// Initialize event listeners
document.addEventListener('DOMContentLoaded', function() {
// Set up profile modal buttons
document.querySelectorAll(".btn-outline").forEach(button => {
button.addEventListener("click", function() {
  const mentor = this.closest(".mentor-card").getAttribute("data-mentor-id") || 
                  this.closest(".mentor-card").querySelector(".mentor-avatar").textContent.toLowerCase();
  openProfile(mentor);
});
});

document.querySelectorAll(".modal-close").forEach(button => {
button.addEventListener("click", function() {
  const modal = this.closest(".modal-overlay");
  const mentor = modal.id.split("-")[0];
  closeProfile(mentor);
});
});

// Set up chat buttons
document.querySelectorAll(".btn-primary").forEach(button => {
button.addEventListener("click", function() {
  // Get mentor ID - either from data attribute or from the first letter of name
  const card = this.closest(".mentor-card");
  if (card) {
    const mentor = card.getAttribute("data-mentor-id") || 
                   card.querySelector(".mentor-avatar").textContent.toLowerCase();
    openChat(mentor);
  } else {
    // For buttons in the profile modal
    const modal = this.closest(".modal-container")?.parentElement;
    if (modal) {
      const mentor = modal.id.split("-")[0];
      closeProfileAndOpenChat(mentor);
    }
  }
});
});

document.querySelectorAll(".back-button").forEach(button => {
button.addEventListener("click", function() {
  const chatContainer = this.closest(".chat-container");
  const mentor = chatContainer.id.split("-")[0];
  closeChat(mentor);
});
});

// Set up message sending
document.querySelectorAll(".chat-input button").forEach(button => {
button.addEventListener("click", function() {
  const chatContainer = this.closest(".chat-container");
  const mentor = chatContainer.id.split("-")[0];
  sendMessage(mentor);
});
});

document.querySelectorAll(".chat-input input").forEach(input => {
input.addEventListener("keypress", function(e) {
  if (e.key === "Enter") {
    const chatContainer = this.closest(".chat-container");
    const mentor = chatContainer.id.split("-")[0];
    sendMessage(mentor);
  }
});
});
});

// Expose functions to window for debugging
window.openProfile = openProfile;
window.closeProfile = closeProfile;
window.openChat = openChat;
window.closeChat = closeChat;
window.sendMessage = sendMessage;
</script>
</body>
</html>